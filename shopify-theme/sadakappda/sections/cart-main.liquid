{% comment %}
  Cart Main Section
{% endcomment %}

<section class="section cart-main">
  <div class="container">
    <h1 class="cart-main__title">Your Cart</h1>
    
    {%- if cart.item_count > 0 -%}
      <div class="cart-main__layout">
        <div class="cart-main__items">
          {%- for item in cart.items -%}
            <div class="cart-main__item" data-key="{{ item.key }}">
              <div class="cart-main__item-image">
                <a href="{{ item.url }}">
                  {%- if item.image -%}
                    <img src="{{ item.image | image_url: width: 200 }}" alt="{{ item.title | escape }}" loading="lazy">
                  {%- endif -%}
                </a>
              </div>
              
              <div class="cart-main__item-content">
                <div class="cart-main__item-header">
                  <div>
                    <h3 class="cart-main__item-title">
                      <a href="{{ item.url }}">{{ item.product.title }}</a>
                    </h3>
                    {%- if item.variant.title != 'Default Title' -%}
                      <p class="cart-main__item-variant">{{ item.variant.title }}</p>
                    {%- endif -%}
                  </div>
                  <button class="cart-main__item-remove" data-remove="{{ item.key }}" aria-label="Remove">
                    {% render 'icon', icon: 'close', size: 18 %}
                  </button>
                </div>
                
                <div class="cart-main__item-footer">
                  <div class="quantity-selector">
                    <button class="quantity-selector__button" data-decrease="{{ item.key }}">âˆ’</button>
                    <input type="number" value="{{ item.quantity }}" min="1" data-quantity="{{ item.key }}">
                    <button class="quantity-selector__button" data-increase="{{ item.key }}">+</button>
                  </div>
                  
                  <div class="cart-main__item-price">
                    {%- if item.original_line_price != item.final_line_price -%}
                      <span class="cart-main__item-price-compare">{{ item.original_line_price | money }}</span>
                    {%- endif -%}
                    <span class="cart-main__item-price-current">{{ item.final_line_price | money }}</span>
                  </div>
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
        
        <div class="cart-main__summary">
          {%- if settings.show_free_shipping_bar -%}
            <div class="cart-summary__shipping-bar">
              {%- assign shipping_threshold = settings.free_shipping_threshold | times: 100 -%}
              {%- assign remaining = shipping_threshold | minus: cart.total_price -%}
              {%- assign percentage = cart.total_price | times: 100 | divided_by: shipping_threshold | at_most: 100 -%}
              
              <div class="shipping-bar">
                <div class="shipping-bar__progress" style="width: {{ percentage }}%;"></div>
              </div>
              <p class="shipping-bar__text">
                {%- if remaining <= 0 -%}
                  You've unlocked FREE shipping!
                {%- else -%}
                  Add {{ remaining | money }} more for FREE shipping
                {%- endif -%}
              </p>
            </div>
          {%- endif -%}
          
          <div class="cart-summary__coupon">
            <label for="coupon-code">Have a coupon code?</label>
            <div class="cart-summary__coupon-input">
              <input type="text" id="coupon-code" placeholder="Enter code">
              <button type="button" class="button button--small">Apply</button>
            </div>
          </div>
          
          <div class="cart-summary__totals">
            <div class="cart-summary__row">
              <span>Subtotal</span>
              <span>{{ cart.total_price | money }}</span>
            </div>
            <div class="cart-summary__row cart-summary__row--note">
              <span>Shipping</span>
              <span>Calculated at checkout</span>
            </div>
          </div>
          
          <div class="cart-summary__total">
            <span>Total</span>
            <span>{{ cart.total_price | money }}</span>
          </div>
          
          <form action="/cart" method="POST">
            <button type="submit" name="checkout" class="button button--primary button--large button--full-width">
              Proceed to Checkout
            </button>
          </form>
          
          <div class="cart-summary__trust">
            {%- if settings.show_secure_badge -%}
              <div class="cart-summary__trust-item">
                {% render 'icon', icon: 'shield', size: 18 %}
                <span>Secure Checkout</span>
              </div>
            {%- endif -%}
            {%- if settings.show_cod_badge -%}
              <div class="cart-summary__trust-item">
                {% render 'icon', icon: 'package', size: 18 %}
                <span>COD Available</span>
              </div>
            {%- endif -%}
          </div>
          
          <a href="/collections/all" class="cart-summary__continue">Continue Shopping</a>
        </div>
      </div>
    {%- else -%}
      <div class="empty-state">
        <div class="empty-state__icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </div>
        <h2 class="empty-state__title">Your cart is empty</h2>
        <p class="empty-state__text">Looks like you haven't added anything to your cart yet.</p>
        <a href="/collections/all" class="button button--primary">Start Shopping</a>
      </div>
    {%- endif -%}
  </div>
</section>

<style>
  .cart-main__title {
    font-size: 2rem;
    margin-bottom: 2rem;
  }
  
  .cart-main__layout {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 3rem;
    align-items: start;
  }
  
  .cart-main__item {
    display: flex;
    gap: 1.5rem;
    padding: 1.5rem 0;
    border-bottom: 1px solid rgba(128, 128, 128, 0.15);
  }
  
  .cart-main__item-image {
    width: 120px;
    flex-shrink: 0;
  }
  
  .cart-main__item-image img {
    width: 100%;
    border-radius: var(--border-radius);
  }
  
  .cart-main__item-content {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  
  .cart-main__item-header {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .cart-main__item-title {
    font-size: 1.125rem;
    font-weight: 500;
    margin: 0;
  }
  
  .cart-main__item-title a {
    color: inherit;
  }
  
  .cart-main__item-variant {
    font-size: 0.875rem;
    opacity: 0.7;
    margin: 0.25rem 0 0;
  }
  
  .cart-main__item-remove {
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--color-body-text);
    opacity: 0.5;
    padding: 0.25rem;
    transition: opacity 0.2s;
  }
  
  .cart-main__item-remove:hover {
    opacity: 1;
  }
  
  .cart-main__item-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
  }
  
  .cart-main__item-price {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .cart-main__item-price-current {
    font-weight: 700;
    font-size: 1.125rem;
  }
  
  .cart-main__item-price-compare {
    text-decoration: line-through;
    opacity: 0.5;
  }
  
  .cart-main__summary {
    background: var(--color-secondary-bg);
    border-radius: var(--border-radius);
    padding: 2rem;
    position: sticky;
    top: 100px;
  }
  
  .cart-summary__shipping-bar {
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(128, 128, 128, 0.15);
  }
  
  .shipping-bar {
    height: 6px;
    background: rgba(128, 128, 128, 0.2);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }
  
  .shipping-bar__progress {
    height: 100%;
    background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
    border-radius: 3px;
  }
  
  .shipping-bar__text {
    font-size: 0.875rem;
    text-align: center;
    margin: 0;
  }
  
  .cart-summary__coupon {
    margin-bottom: 1.5rem;
  }
  
  .cart-summary__coupon label {
    display: block;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
  }
  
  .cart-summary__coupon-input {
    display: flex;
    gap: 0.5rem;
  }
  
  .cart-summary__coupon-input input {
    flex: 1;
  }
  
  .cart-summary__totals {
    padding: 1.5rem 0;
    border-top: 1px solid rgba(128, 128, 128, 0.15);
    border-bottom: 1px solid rgba(128, 128, 128, 0.15);
  }
  
  .cart-summary__row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
  }
  
  .cart-summary__row:last-child {
    margin-bottom: 0;
  }
  
  .cart-summary__row--note {
    font-size: 0.875rem;
    opacity: 0.7;
  }
  
  .cart-summary__total {
    display: flex;
    justify-content: space-between;
    font-size: 1.25rem;
    font-weight: 700;
    padding: 1.5rem 0;
  }
  
  .cart-summary__trust {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(128, 128, 128, 0.15);
  }
  
  .cart-summary__trust-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8125rem;
  }
  
  .cart-summary__trust-item svg {
    color: var(--color-primary);
  }
  
  .cart-summary__continue {
    display: block;
    text-align: center;
    margin-top: 1rem;
    color: var(--color-primary);
    font-size: 0.9375rem;
  }
  
  @media (max-width: 1024px) {
    .cart-main__layout {
      grid-template-columns: 1fr;
    }
    
    .cart-main__summary {
      position: static;
    }
  }
  
  @media (max-width: 768px) {
    .cart-main__item {
      flex-direction: column;
      gap: 1rem;
    }
    
    .cart-main__item-image {
      width: 100%;
      max-width: 150px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Cart item quantity and remove functionality
    document.querySelectorAll('[data-remove]').forEach(btn => {
      btn.addEventListener('click', function() {
        updateCartItem(this.dataset.remove, 0);
      });
    });
    
    document.querySelectorAll('[data-decrease]').forEach(btn => {
      btn.addEventListener('click', function() {
        const input = document.querySelector(`[data-quantity="${this.dataset.decrease}"]`);
        const newQty = Math.max(0, parseInt(input.value) - 1);
        updateCartItem(this.dataset.decrease, newQty);
      });
    });
    
    document.querySelectorAll('[data-increase]').forEach(btn => {
      btn.addEventListener('click', function() {
        const input = document.querySelector(`[data-quantity="${this.dataset.increase}"]`);
        const newQty = parseInt(input.value) + 1;
        updateCartItem(this.dataset.increase, newQty);
      });
    });
    
    function updateCartItem(key, quantity) {
      fetch('/cart/change.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: key, quantity: quantity })
      })
      .then(response => response.json())
      .then(data => {
        window.location.reload();
      })
      .catch(err => console.error('Error:', err));
    }
  });
</script>

{% schema %}
{
  "name": "Cart Main",
  "settings": []
}
{% endschema %}