{% comment %}
  Header Section - Fully configurable via Theme Settings
{% endcomment %}

{%- comment %} Determine header colors from theme settings {% endcomment -%}
{%- assign header_bg = settings.color_header_background -%}
{%- assign header_text = settings.color_header_text -%}

<header 
  id="site-header" 
  class="header {% if settings.header_sticky %}header--sticky{% endif %} {% if settings.header_transparent and template == 'index' %}header--transparent{% endif %}"
  style="background-color: {{ header_bg }}; color: {{ header_text }};"
>
  <div class="container">
    <div class="header__inner">
      {%- comment %} Mobile Menu Toggle {% endcomment -%}
      <button class="header__menu-toggle hidden--desktop" data-mobile-menu-open aria-label="Open menu" style="color: {{ header_text }};">
        {% render 'icon', icon: 'menu', size: 24 %}
      </button>
      
      {%- comment %} Logo - Uses Theme Settings {% endcomment -%}
      <div class="header__logo">
        <a href="/" class="header__logo-link">
          {%- if settings.logo != blank -%}
            {%- comment %} Desktop Logo {% endcomment -%}
            <img 
              class="header__logo-image header__logo-image--desktop"
              src="{{ settings.logo | image_url: width: 400 }}" 
              alt="{{ shop.name }}"
              width="{{ settings.logo_width }}"
              height="auto"
              loading="eager"
            >
            {%- comment %} Mobile Logo {% endcomment -%}
            {%- if settings.logo_mobile != blank -%}
              <img 
                class="header__logo-image header__logo-image--mobile"
                src="{{ settings.logo_mobile | image_url: width: 300 }}" 
                alt="{{ shop.name }}"
                width="{{ settings.logo_width_mobile }}"
                height="auto"
                loading="eager"
              >
            {%- else -%}
              <img 
                class="header__logo-image header__logo-image--mobile"
                src="{{ settings.logo | image_url: width: 300 }}" 
                alt="{{ shop.name }}"
                width="{{ settings.logo_width_mobile }}"
                height="auto"
                loading="eager"
              >
            {%- endif -%}
          {%- else -%}
            <span class="header__logo-text" style="color: {{ header_text }};">{{ shop.name }}</span>
          {%- endif -%}
        </a>
      </div>
      
      {%- comment %} Desktop Navigation {% endcomment -%}
      <nav class="header__nav hidden--mobile" role="navigation">
        <ul class="header__nav-list">
          {%- if section.settings.menu != blank -%}
            {%- for link in section.settings.menu.links -%}
              <li class="header__nav-item {% if link.links.size > 0 %}has-dropdown{% endif %}">
                <a href="{{ link.url }}" class="header__nav-link {% if link.active %}is-active{% endif %}" style="color: {{ header_text }};">
                  {{ link.title }}
                  {%- if link.links.size > 0 -%}
                    {% render 'icon', icon: 'chevron-down', size: 16 %}
                  {%- endif -%}
                </a>
                
                {%- if link.links.size > 0 -%}
                  <div class="header__dropdown">
                    <ul class="header__dropdown-list">
                      {%- for child_link in link.links -%}
                        <li class="header__dropdown-item">
                          <a href="{{ child_link.url }}" class="header__dropdown-link">
                            {{ child_link.title }}
                          </a>
                        </li>
                      {%- endfor -%}
                    </ul>
                  </div>
                {%- endif -%}
              </li>
            {%- endfor -%}
          {%- else -%}
            {%- comment %} Fallback menu when no menu is selected {% endcomment -%}
            <li class="header__nav-item"><a href="/collections/all" class="header__nav-link" style="color: {{ header_text }};">Shop All</a></li>
            <li class="header__nav-item"><a href="/collections/men" class="header__nav-link" style="color: {{ header_text }};">Men</a></li>
            <li class="header__nav-item"><a href="/collections/women" class="header__nav-link" style="color: {{ header_text }};">Women</a></li>
            <li class="header__nav-item"><a href="/collections/new-arrivals" class="header__nav-link" style="color: {{ header_text }};">New Arrivals</a></li>
            <li class="header__nav-item"><a href="/pages/size-guide" class="header__nav-link" style="color: {{ header_text }};">Size Guide</a></li>
          {%- endif -%}
        </ul>
      </nav>
      
      {%- comment %} Header Actions {% endcomment -%}
      <div class="header__actions">
        {%- comment %} Search - Controlled by Theme Settings {% endcomment -%}
        {%- if settings.header_show_search -%}
          <button class="header__action" data-search-toggle aria-label="Search" style="color: {{ header_text }};">
            {% render 'icon', icon: 'search', size: 22 %}
          </button>
        {%- endif -%}
        
        {%- comment %} Account - Controlled by Theme Settings {% endcomment -%}
        {%- if settings.header_show_account -%}
          <a href="{% if customer %}/account{% else %}/account/login{% endif %}" class="header__action hidden--mobile" aria-label="Account" style="color: {{ header_text }};">
            {% render 'icon', icon: 'user', size: 22 %}
          </a>
        {%- endif -%}
        
        {%- comment %} Cart - Controlled by Theme Settings {% endcomment -%}
        {%- if settings.header_show_cart -%}
          <button class="header__action header__cart" data-cart-drawer-open aria-label="Cart" style="color: {{ header_text }};">
            {% render 'icon', icon: 'cart', size: 22 %}
            <span class="header__cart-count" data-cart-count style="{% if cart.item_count == 0 %}display: none;{% endif %}">
              {{ cart.item_count }}
            </span>
          </button>
        {%- endif -%}
      </div>
    </div>
  </div>
</header>

{%- comment %} Mobile Menu {% endcomment -%}
<div id="mobile-menu-overlay" class="drawer__overlay"></div>
<nav id="mobile-menu" class="mobile-menu drawer" style="background-color: {{ header_bg }}; color: {{ header_text }};">
  <div class="drawer__header" style="border-color: rgba({{ settings.color_header_text | color_to_rgb | remove: 'rgb(' | remove: ')' }}, 0.1);">
    <span class="drawer__title" style="color: {{ header_text }};">Menu</span>
    <button class="drawer__close" data-mobile-menu-close aria-label="Close menu" style="color: {{ header_text }};">
      {% render 'icon', icon: 'close', size: 24 %}
    </button>
  </div>
  <div class="drawer__body">
    <ul class="mobile-menu__list">
      {%- if section.settings.menu != blank -%}
        {%- for link in section.settings.menu.links -%}
          <li class="mobile-menu__item">
            {%- if link.links.size > 0 -%}
              <button class="mobile-menu__link" data-submenu-toggle style="color: {{ header_text }};">
                {{ link.title }}
                {% render 'icon', icon: 'chevron-down', size: 18 %}
              </button>
              <ul class="mobile-menu__submenu">
                <li><a href="{{ link.url }}" class="mobile-menu__sublink" style="color: {{ header_text }};">View All {{ link.title }}</a></li>
                {%- for child_link in link.links -%}
                  <li><a href="{{ child_link.url }}" class="mobile-menu__sublink" style="color: {{ header_text }};">{{ child_link.title }}</a></li>
                {%- endfor -%}
              </ul>
            {%- else -%}
              <a href="{{ link.url }}" class="mobile-menu__link" style="color: {{ header_text }};">{{ link.title }}</a>
            {%- endif -%}
          </li>
        {%- endfor -%}
      {%- else -%}
        {%- comment %} Fallback mobile menu {% endcomment -%}
        <li class="mobile-menu__item"><a href="/collections/all" class="mobile-menu__link" style="color: {{ header_text }};">Shop All</a></li>
        <li class="mobile-menu__item"><a href="/collections/men" class="mobile-menu__link" style="color: {{ header_text }};">Men</a></li>
        <li class="mobile-menu__item"><a href="/collections/women" class="mobile-menu__link" style="color: {{ header_text }};">Women</a></li>
        <li class="mobile-menu__item"><a href="/collections/new-arrivals" class="mobile-menu__link" style="color: {{ header_text }};">New Arrivals</a></li>
        <li class="mobile-menu__item"><a href="/pages/size-guide" class="mobile-menu__link" style="color: {{ header_text }};">Size Guide</a></li>
      {%- endif -%}
    </ul>
    
    <div class="mobile-menu__footer" style="border-color: rgba({{ settings.color_header_text | color_to_rgb | remove: 'rgb(' | remove: ')' }}, 0.1);">
      <a href="/account" class="mobile-menu__footer-link" style="color: {{ header_text }};">
        {% render 'icon', icon: 'user', size: 20 %}
        <span>My Account</span>
      </a>
      {%- if settings.contact_email != blank -%}
        <a href="mailto:{{ settings.contact_email }}" class="mobile-menu__footer-link" style="color: {{ header_text }};">
          <span>{{ settings.contact_email }}</span>
        </a>
      {%- endif -%}
    </div>
  </div>
</nav>

{%- comment %} Search Overlay {% endcomment -%}
<div id="search-overlay" class="search-overlay">
  <div class="search-overlay__inner">
    <div class="search-overlay__header">
      <form action="{{ routes.search_url }}" method="get" class="search-form" role="search">
        <input type="hidden" name="type" value="product">
        <div class="search-form__field">
          {% render 'icon', icon: 'search', size: 20 %}
          <input 
            type="search" 
            name="q" 
            id="search-input"
            class="search-form__input" 
            placeholder="Search products..."
            autocomplete="off"
            data-predictive-search-input
          >
        </div>
      </form>
      <button class="search-overlay__close" data-search-close aria-label="Close search">
        {% render 'icon', icon: 'close', size: 24 %}
      </button>
    </div>
    <div class="search-results" data-predictive-search-results>
      {%- comment %} Results populated via JavaScript {% endcomment -%}
    </div>
  </div>
</div>

<style>
  /* Header Base Styles */
  .header {
    position: relative;
    z-index: 100;
    transition: background-color 0.3s, box-shadow 0.3s;
  }
  
  .header--sticky {
    position: sticky;
    top: 0;
  }
  
  .header--transparent {
    position: absolute;
    width: 100%;
    background-color: transparent !important;
  }
  
  .header.is-scrolled {
    background-color: var(--color-header-bg) !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 70px;
    gap: 1rem;
  }
  
  /* Logo */
  .header__logo {
    flex-shrink: 0;
  }
  
  .header__logo-link {
    display: flex;
    align-items: center;
  }
  
  .header__logo-image {
    max-height: 50px;
    width: auto;
    object-fit: contain;
  }
  
  .header__logo-image--desktop {
    display: block;
    max-width: var(--logo-width);
  }
  
  .header__logo-image--mobile {
    display: none;
    max-width: var(--logo-width-mobile);
  }
  
  .header__logo-text {
    font-family: var(--font-heading);
    font-size: 1.5rem;
    font-weight: 700;
    text-decoration: none;
  }
  
  /* Navigation */
  .header__nav {
    flex: 1;
    display: flex;
    justify-content: center;
  }
  
  .header__nav-list {
    display: flex;
    align-items: center;
    gap: 2rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .header__nav-item {
    position: relative;
  }
  
  .header__nav-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.9375rem;
    font-weight: 500;
    text-decoration: none;
    padding: 0.5rem 0;
    transition: opacity 0.2s;
  }
  
  .header__nav-link:hover {
    opacity: 0.8;
    text-decoration: none;
  }
  
  .header__nav-link.is-active {
    opacity: 1;
  }
  
  /* Dropdown */
  .header__dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    min-width: 200px;
    background: var(--color-background);
    border-radius: var(--border-radius);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s, visibility 0.2s;
    padding: 0.5rem 0;
    z-index: 101;
  }
  
  .header__nav-item:hover .header__dropdown {
    opacity: 1;
    visibility: visible;
  }
  
  .header__dropdown-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .header__dropdown-link {
    display: block;
    padding: 0.625rem 1.25rem;
    color: var(--color-text);
    font-size: 0.875rem;
    text-decoration: none;
    transition: background 0.2s;
  }
  
  .header__dropdown-link:hover {
    background: var(--color-background-secondary);
    text-decoration: none;
  }
  
  /* Header Actions */
  .header__actions {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  
  .header__action {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: opacity 0.2s;
    text-decoration: none;
  }
  
  .header__action:hover {
    opacity: 0.7;
  }
  
  .header__cart {
    position: relative;
  }
  
  .header__cart-count {
    position: absolute;
    top: 4px;
    right: 4px;
    min-width: 18px;
    height: 18px;
    background: var(--color-primary);
    color: #fff;
    font-size: 0.6875rem;
    font-weight: 700;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .header__menu-toggle {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
  }
  
  /* Mobile Menu */
  .drawer__overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    z-index: 998;
  }
  
  .drawer__overlay.is-open {
    opacity: 1;
    visibility: visible;
  }
  
  .mobile-menu {
    position: fixed;
    top: 0;
    left: -100%;
    width: 300px;
    max-width: 85vw;
    height: 100%;
    z-index: 999;
    transition: left 0.3s ease;
    display: flex;
    flex-direction: column;
  }
  
  .mobile-menu.is-open {
    left: 0;
  }
  
  .drawer__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid;
  }
  
  .drawer__title {
    font-family: var(--font-heading);
    font-size: 1.125rem;
    font-weight: 700;
  }
  
  .drawer__close {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    cursor: pointer;
  }
  
  .drawer__body {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
  }
  
  .mobile-menu__list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .mobile-menu__link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.875rem 1.5rem;
    background: transparent;
    border: none;
    font-size: 1rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    text-align: left;
  }
  
  .mobile-menu__submenu {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    padding-left: 1rem;
  }
  
  .mobile-menu__item.is-open .mobile-menu__submenu {
    display: block;
  }
  
  .mobile-menu__sublink {
    display: block;
    padding: 0.625rem 1.5rem;
    font-size: 0.9375rem;
    text-decoration: none;
    opacity: 0.8;
  }
  
  .mobile-menu__footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid;
    margin-top: auto;
  }
  
  .mobile-menu__footer-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    text-decoration: none;
    font-size: 0.9375rem;
  }
  
  /* Search Overlay */
  .search-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s, visibility 0.3s;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 15vh;
  }
  
  .search-overlay.is-open {
    opacity: 1;
    visibility: visible;
  }
  
  .search-overlay__inner {
    width: 90%;
    max-width: 600px;
  }
  
  .search-overlay__header {
    display: flex;
    gap: 1rem;
    align-items: center;
  }
  
  .search-form {
    flex: 1;
  }
  
  .search-form__field {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: #fff;
    border-radius: var(--border-radius);
    padding: 0.75rem 1rem;
  }
  
  .search-form__field svg {
    color: var(--color-text-secondary);
    flex-shrink: 0;
  }
  
  .search-form__input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 1rem;
    background: transparent;
  }
  
  .search-overlay__close {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    color: #fff;
    cursor: pointer;
  }
  
  .search-results {
    margin-top: 1.5rem;
    max-height: 50vh;
    overflow-y: auto;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .header__inner {
      height: 60px;
    }
    
    .header__logo-image--desktop {
      display: none;
    }
    
    .header__logo-image--mobile {
      display: block;
    }
    
    .header__action {
      width: 40px;
      height: 40px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu toggle
    const mobileMenuOpen = document.querySelector('[data-mobile-menu-open]');
    const mobileMenuClose = document.querySelector('[data-mobile-menu-close]');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    
    function openMobileMenu() {
      mobileMenu.classList.add('is-open');
      mobileMenuOverlay.classList.add('is-open');
      document.body.style.overflow = 'hidden';
    }
    
    function closeMobileMenu() {
      mobileMenu.classList.remove('is-open');
      mobileMenuOverlay.classList.remove('is-open');
      document.body.style.overflow = '';
    }
    
    if (mobileMenuOpen) mobileMenuOpen.addEventListener('click', openMobileMenu);
    if (mobileMenuClose) mobileMenuClose.addEventListener('click', closeMobileMenu);
    if (mobileMenuOverlay) mobileMenuOverlay.addEventListener('click', closeMobileMenu);
    
    // Submenu toggle
    document.querySelectorAll('[data-submenu-toggle]').forEach(btn => {
      btn.addEventListener('click', function() {
        this.closest('.mobile-menu__item').classList.toggle('is-open');
      });
    });
    
    // Search toggle
    const searchToggle = document.querySelector('[data-search-toggle]');
    const searchClose = document.querySelector('[data-search-close]');
    const searchOverlay = document.getElementById('search-overlay');
    const searchInput = document.getElementById('search-input');
    
    function openSearch() {
      searchOverlay.classList.add('is-open');
      document.body.style.overflow = 'hidden';
      setTimeout(() => searchInput.focus(), 100);
    }
    
    function closeSearch() {
      searchOverlay.classList.remove('is-open');
      document.body.style.overflow = '';
    }
    
    if (searchToggle) searchToggle.addEventListener('click', openSearch);
    if (searchClose) searchClose.addEventListener('click', closeSearch);
    
    // Close on escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeMobileMenu();
        closeSearch();
      }
    });
    
    // Sticky header scroll effect
    const header = document.getElementById('site-header');
    if (header && header.classList.contains('header--transparent')) {
      window.addEventListener('scroll', function() {
        if (window.scrollY > 50) {
          header.classList.add('is-scrolled');
        } else {
          header.classList.remove('is-scrolled');
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "header",
      "content": "Navigation Menu"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Main menu",
      "default": "main-menu",
      "info": "Create menus in Shopify Admin → Online Store → Navigation"
    },
    {
      "type": "header",
      "content": "Note"
    },
    {
      "type": "paragraph",
      "content": "Header colors, logo, and display options are controlled in Theme Settings for global consistency."
    }
  ],
  "presets": [
    {
      "name": "Header"
    }
  ]
}
{% endschema %}
