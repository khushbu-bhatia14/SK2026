{% comment %}
  Renders a product card
  
  Accepts:
  - product: {Object} Shopify product object
  - show_vendor: {Boolean} Show vendor name
  - show_swatches: {Boolean} Show color swatches
  - show_quick_add: {Boolean} Show quick add button
  - lazy_load: {Boolean} Lazy load images
  
  Usage:
  {% render 'product-card', product: product, show_swatches: true %}
{% endcomment %}

{%- liquid
  assign show_vendor = show_vendor | default: false
  assign show_swatches = show_swatches | default: settings.show_color_swatches
  assign show_quick_add = show_quick_add | default: settings.show_quick_add
  assign lazy_load = lazy_load | default: true
  
  assign featured_image = product.featured_media.preview_image
  assign second_image = product.media[1].preview_image
-%}

<article class="product-card">
  <div class="product-card__image-wrapper">
    <a href="{{ product.url }}" aria-label="{{ product.title }}">
      {%- if featured_image -%}
        <img
          class="product-card__image product-card__image--primary"
          src="{{ featured_image | image_url: width: 600 }}"
          alt="{{ featured_image.alt | escape }}"
          width="{{ featured_image.width }}"
          height="{{ featured_image.height }}"
          {%- if lazy_load %}loading="lazy"{% endif -%}
        >
      {%- else -%}
        <div class="product-card__image product-card__image--placeholder" style="background: var(--color-secondary-bg); aspect-ratio: 3/4;"></div>
      {%- endif -%}
      
      {%- if second_image and settings.show_hover_image -%}
        <img
          class="product-card__image product-card__image--secondary"
          src="{{ second_image | image_url: width: 600 }}"
          alt="{{ second_image.alt | escape }}"
          width="{{ second_image.width }}"
          height="{{ second_image.height }}"
          loading="lazy"
        >
      {%- endif -%}
    </a>
    
    {%- comment %} Badges {% endcomment -%}
    <div class="product-card__badges">
      {%- if product.compare_at_price > product.price and settings.show_sale_badge -%}
        {%- assign discount = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
        <span class="badge badge--sale">{{ discount }}% OFF</span>
      {%- endif -%}
      
      {%- if settings.show_new_badge -%}
        {%- assign product_age = product.published_at | date: '%s' | plus: 0 -%}
        {%- assign now = 'now' | date: '%s' | plus: 0 -%}
        {%- assign days_old = now | minus: product_age | divided_by: 86400 -%}
        {%- if days_old < 30 -%}
          <span class="badge badge--new">New</span>
        {%- endif -%}
      {%- endif -%}
    </div>
    
    {%- comment %} Wishlist Button {% endcomment -%}
    <button class="product-card__wishlist" aria-label="Add to wishlist">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
    </button>
    
    {%- comment %} Quick Add Button {% endcomment -%}
    {%- if show_quick_add and product.available -%}
      {%- if product.variants.size == 1 -%}
        <button class="product-card__quick-add" data-quick-add="{{ product.variants.first.id }}">
          Add to Cart
        </button>
      {%- else -%}
        <a href="{{ product.url }}" class="product-card__quick-add">
          Select Options
        </a>
      {%- endif -%}
    {%- elsif product.available == false -%}
      <span class="product-card__quick-add" style="background: #666; cursor: default;">
        Sold Out
      </span>
    {%- endif -%}
  </div>
  
  <div class="product-card__content">
    {%- if show_vendor and product.vendor -%}
      <span class="product-card__vendor">{{ product.vendor }}</span>
    {%- endif -%}
    
    <h3 class="product-card__title">
      <a href="{{ product.url }}">{{ product.title }}</a>
    </h3>
    
    {%- comment %} Color Swatches {% endcomment -%}
    {%- if show_swatches -%}
      {%- assign color_option = product.options_by_name['Color'] -%}
      {%- if color_option -%}
        <div class="product-card__swatches">
          {%- for value in color_option.values limit: 4 -%}
            {%- assign color_value = value | downcase | replace: ' ', '' -%}
            <span 
              class="product-card__swatch" 
              style="background-color: {{ color_value }};"
              title="{{ value }}"
            ></span>
          {%- endfor -%}
          {%- if color_option.values.size > 4 -%}
            <span class="product-card__swatch--more">+{{ color_option.values.size | minus: 4 }}</span>
          {%- endif -%}
        </div>
      {%- endif -%}
    {%- endif -%}
    
    {%- comment %} Price {% endcomment -%}
    <div class="product-card__price">
      {%- if product.compare_at_price > product.price -%}
        <span class="product-card__price-current product-card__price-sale">
          {{ product.price | money }}
        </span>
        <span class="product-card__price-compare">
          {{ product.compare_at_price | money }}
        </span>
      {%- else -%}
        <span class="product-card__price-current">
          {%- if product.price_varies -%}
            From {{ product.price_min | money }}
          {%- else -%}
            {{ product.price | money }}
          {%- endif -%}
        </span>
      {%- endif -%}
    </div>
  </div>
</article>