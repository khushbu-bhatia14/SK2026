{% comment %}
  Customer Order Template
{% endcomment %}

<section class="section customer-order">
  <div class="container">
    <nav class="breadcrumbs">
      <a href="/">Home</a>
      <span class="breadcrumbs__separator">/</span>
      <a href="/account">Account</a>
      <span class="breadcrumbs__separator">/</span>
      <span>{{ order.name }}</span>
    </nav>
    
    <h1>Order {{ order.name }}</h1>
    <p class="order-date">Placed on {{ order.created_at | date: '%B %d, %Y at %I:%M %p' }}</p>
    
    {%- if order.cancelled -%}
      <div class="order-cancelled">
        <p><strong>Order Cancelled</strong> on {{ order.cancelled_at | date: '%B %d, %Y' }}</p>
        <p>Reason: {{ order.cancel_reason }}</p>
      </div>
    {%- endif -%}
    
    <div class="order-grid">
      <div class="order-items">
        <h2>Order Items</h2>
        <table class="order-items-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Qty</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {%- for line_item in order.line_items -%}
              <tr>
                <td data-label="Product">
                  <div class="order-item">
                    {%- if line_item.image -%}
                      <img src="{{ line_item.image | image_url: width: 80 }}" alt="{{ line_item.title }}">
                    {%- endif -%}
                    <div>
                      <a href="{{ line_item.url }}">{{ line_item.title }}</a>
                      {%- if line_item.variant.title != 'Default Title' -%}
                        <span class="order-item__variant">{{ line_item.variant.title }}</span>
                      {%- endif -%}
                    </div>
                  </div>
                </td>
                <td data-label="Price">{{ line_item.original_price | money }}</td>
                <td data-label="Qty">{{ line_item.quantity }}</td>
                <td data-label="Total">{{ line_item.final_line_price | money }}</td>
              </tr>
            {%- endfor -%}
          </tbody>
        </table>
        
        <div class="order-totals">
          <div class="order-totals__row">
            <span>Subtotal</span>
            <span>{{ order.line_items_subtotal_price | money }}</span>
          </div>
          {%- for discount in order.discounts -%}
            <div class="order-totals__row">
              <span>Discount ({{ discount.code }})</span>
              <span>-{{ discount.savings | money }}</span>
            </div>
          {%- endfor -%}
          {%- for shipping_method in order.shipping_methods -%}
            <div class="order-totals__row">
              <span>Shipping ({{ shipping_method.title }})</span>
              <span>{{ shipping_method.price | money }}</span>
            </div>
          {%- endfor -%}
          {%- for tax_line in order.tax_lines -%}
            <div class="order-totals__row">
              <span>Tax ({{ tax_line.title }} {{ tax_line.rate | times: 100 }}%)</span>
              <span>{{ tax_line.price | money }}</span>
            </div>
          {%- endfor -%}
          <div class="order-totals__row order-totals__row--total">
            <span>Total</span>
            <span>{{ order.total_price | money }}</span>
          </div>
        </div>
      </div>
      
      <div class="order-details">
        <div class="order-detail-block">
          <h3>Shipping Address</h3>
          {{ order.shipping_address | format_address }}
        </div>
        
        <div class="order-detail-block">
          <h3>Billing Address</h3>
          {{ order.billing_address | format_address }}
        </div>
        
        {%- if order.fulfillments.size > 0 -%}
          <div class="order-detail-block">
            <h3>Tracking</h3>
            {%- for fulfillment in order.fulfillments -%}
              {%- if fulfillment.tracking_url -%}
                <a href="{{ fulfillment.tracking_url }}" target="_blank" rel="noopener">
                  Track your shipment ({{ fulfillment.tracking_company }})
                </a>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>
    </div>
    
    <a href="/account" class="button button--secondary">Back to Account</a>
  </div>
</section>

<style>
  .order-date {
    opacity: 0.7;
    margin-bottom: 2rem;
  }
  
  .order-cancelled {
    background: rgba(231, 76, 60, 0.1);
    color: #e74c3c;
    padding: 1rem;
    border-radius: var(--border-radius);
    margin-bottom: 2rem;
  }
  
  .order-grid {
    display: grid;
    grid-template-columns: 1fr 350px;
    gap: 3rem;
    margin: 2rem 0;
  }
  
  .order-items-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
  }
  
  .order-items-table th,
  .order-items-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid rgba(128, 128, 128, 0.15);
  }
  
  .order-item {
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  
  .order-item img {
    width: 60px;
    border-radius: var(--border-radius);
  }
  
  .order-item__variant {
    display: block;
    font-size: 0.875rem;
    opacity: 0.7;
  }
  
  .order-totals__row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(128, 128, 128, 0.1);
  }
  
  .order-totals__row--total {
    font-weight: 700;
    font-size: 1.125rem;
    border-bottom: none;
    padding-top: 1rem;
  }
  
  .order-detail-block {
    background: var(--color-secondary-bg);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    margin-bottom: 1rem;
  }
  
  .order-detail-block h3 {
    font-size: 1rem;
    margin-bottom: 0.75rem;
  }
  
  @media (max-width: 1024px) {
    .order-grid {
      grid-template-columns: 1fr;
    }
  }
</style>